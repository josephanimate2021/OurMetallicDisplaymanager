var URL_POST_COMMENT="/ajax/postComment";var URL_DELETE_COMMENT="/ajax/deleteComment";var URL_FLAG_COMMENT="/ajax/flagComment";function reloadCaptcha(B,A){if(A==null){$("captchatext").clear();postComment(B,"none","none")}else{if(A>0){$("captchatext").clear();sendInvite(A)}else{$("emailshare_captchatext").clear();$("overlayLoadingTextSnd").style.display="none";$("overlayLoadingCaptcha").style.display="block";sendShare()}}}function switchCaptcha(C,A){var B="";if(A<0){B="emailshare_"}if($(B+"captcha_type").getAttribute("value")=="image"){$(B+"captcha_type").setAttribute("value","audio")}else{if($(B+"captcha_type").getAttribute("value")=="audio"){$(B+"captcha_type").setAttribute("value","image")}else{return }}alert(B);reloadCaptcha(C,A)}function postComment(D,C,F,A,E){pageTracker._trackPageview("/pageTracker/ajax/comment/postComment");clearFeedback();var B=$(D);if(B.subject!=null&&B.subject.value==""){displayFeedback("2"+GT.gettext("Please enter your subject"));hidePleaseWait();return }if(B.comment_content.value==""){displayFeedback("3"+GT.gettext("Please enter your message"));hidePleaseWait();return }path=URL_POST_COMMENT;if(A=="false"){path=URL_POST_COMMENT+"/false/"+E}new Ajax.Request(path,{method:"post",parameters:$(D).serialize(),onSuccess:function(H){var G=H.responseText;postCommentComplete(G,D,C,F)},onFailure:function(){displayFeedback("1Error contacting the server");$(D).enable();hidePleaseWait()}});$(D).disable()}function postCommentComplete(C,B,A,D){parseResponse(C);$(B).enable();switch(responseArray.code){case"0":pageTracker._trackPageview("/pageTracker/ajax/comment/postComplete");responseArray.json.error=GT.gettext("Comment successfully posted");displayFeedback(responseArray.code+responseArray.json.error);if(A=="append"||A=="prepend"){displayComment(responseArray.html,A,D)}else{if(A=="redirect"){window.location=responseArray.json.url}}resetCommentForm(B);document.saveCommentForm.comment_content.disabled="disabled";if(typeof document.saveCommentForm.Post!="undefined"){document.saveCommentForm.Post.disabled="disabled";$("recaptcha").style.display="none"}$(B).reset();break;case"1":$("recaptcha").style.display="block";break;case"2":$("captcha_type").setAttribute("value","audio");$("captcha_id").setAttribute("value",responseArray.json.session_id);$("captcha_audio").innerHTML=getAudioEmbedString(responseArray.json.url);$("comment_captcha").style.display="block";$("image_captcha").style.display="none";$("audio_captcha").style.display="block";break;case"3":$(B).reset();document.saveCommentForm.comment_content.disabled="disabled";document.saveCommentForm.Post.disabled="disabled";$("recaptcha").style.display="none";default:displayFeedback(responseArray.code+responseArray.json.error);resetCommentForm(B);break}hidePleaseWait();resetResponse()}function getAudioEmbedString(A){return'<object classid="CLSID:22D6F312-B0F6-11D0-94AB-0080C74C7E95" type="application/x-oleobject" height="40" width="170"><param name="autoplay" value="true"><param name="src" value="'+A+'"><param name="autoStart" value="1"><embed height="40" autostart="true" bgcolor="white" src="'+A+'" type="application/x-mplayer2"/></object>'}function resetCommentForm(A){$("captcha_id").setAttribute("value","");$("captcha_type").setAttribute("value","");$("captcha_image").setAttribute("src","");$("comment_captcha").style.display="none";$("image_captcha").style.display="none";$("audio_captcha").style.display="none"}function displayComment(A,B,C){if(B=="prepend"){newHtml=A+$(C).innerHTML}else{newHtml=$(C).innerHTML+A}$(C).innerHTML=newHtml}function deleteComment(C,A,B){var D=GT.gettext("Are you sure to delete this Comment/Post?");if(!confirm(D)){return }else{new Ajax.Request(URL_DELETE_COMMENT+"/"+C+"/"+B,{method:"post",onSuccess:function(F){var E=F.responseText;deleteCommentComplete(E,A)},onFailure:function(){displayFeedback("1Error contacting the server")}})}}function deleteCommentComplete(B,A){parseResponse(B);if(typeof responseArray.json.url!="undefined"){window.location=responseArray.json.url}else{if(responseArray.code=="0"){displayFeedback(responseArray.code+GT.gettext("Comment has been deleted"));$(A).remove()}else{displayFeedback(responseArray.code+responseArray.json.error)}}resetResponse()}function flagComment(A){new Ajax.Request(URL_FLAG_COMMENT+"/"+A,{method:"post",onSuccess:function(C){var B=C.responseText;flagCommentComplete(B)},onFailure:function(){displayFeedback("1Error contacting the server")}})}function flagCommentComplete(A){parseResponse(A);if(typeof responseArray.json.url!="undefined"){window.location=responseArray.json.url}else{if(responseArray.code=="0"){displayFeedback(responseArray.code+GT.gettext("Comment flagged as inappropriate"))}else{displayFeedback(responseArray.code+responseArray.json.error)}}resetResponse()}function showCommentContent(B,A,C){if($(B).innerHTML=="show"){$(B).innerHTML="hide";$(A).show();$(C).show()}else{$(B).innerHTML="show";$(A).hide();$(C).hide()}};